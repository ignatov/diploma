\subsection{Архитектура компилятора Extensible Kotlin}\label{architecture}
Компилятор Extensible Kotlin построен на основе компилятора Kotlin.

Рассмотрим стандартные шаги компиляции:
\begin{itemize}
\item[---] Лексический разбор;
\item[---] Грамматический разбор;
\item[---] Построение внутреннего представления программы;
\item[---] Статический анализ; \td
\item[---] Генерация байт-кода (при успешном завершении проверок из предыдущего пункта);
\end{itemize}

Существенным отличием компилятора Extensible Kotlin от компилятора Kotlin является дополнительная фаза компиляции~--- трансформация внутреннего представления программы  и последующие статические проверки. То есть шаги компиляции программы с помощью компилятора Extensible Kotlin выглядят следующим образом:
\begin{itemize}
\item[---] Лексический разбор;
\item[---] Грамматический разбор;
\item[---] Построение внутреннего представления программы;
\item[---] Статический анализ; \td
\item[---] Трансформация внутреннего представления программы (при успешном завершении проверок из предыдущего пункта);
\item[---] Статический анализ вновь полученных структур; \td
\item[---] Генерация байт-кода (при успешном завершении проверок из предыдущего пункта);
\end{itemize}

\subsubsection{Расширяемые компиляторы в других языках} % TODO: нужно подробнее
Ряд современных языков программирования поддерживает компиляцию в несколько отдельных фаз.
В основном, такие языки являются расширениями уже существующих языков: MetaOCaml~\cite{metaocaml}, MetaMl~\cite{metaml}, 'C~\cite{extendible-c}, но есть и самостоятельные, как например, Scala~\cite{scala-spec}. 

Компиляторы таких языков позволяют управлять ходом компиляции программы с помощью специальных пользовательских расширений (Compiler Plugins~\cite{scala-compiler-plugin}). Стоит отметить, что на сегодняшний день в компиляторе языка Scala существует 21 стандартная фаза компиляции и поведение каждой из них можно изменить. Также существует возможность добавлять новые стадии компиляции, указывая порядок выполнения расширений.

Например, код расширения~\footnote{\url{http://www.scala-lang.org/node/140}}, которое проверяет деление на ноль в явном виде, должно выполняться после стадии проверки всех ссылочных значений. Исходный код такого расширения занимает всего тридцать строк кода. Что показывает мощь и выразительность данного подхода.

По схожему принципу построена работа компилятора языка Extensible Kotlin.